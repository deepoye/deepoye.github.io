import{A as Y,B as J,C as Fe,D as B,E as P,F as L,a as Me,d as ke,g as De,i as Oe,m as Ee,n as F,o as Te,s as g,t as ze,u as _,y as Ie,z as Ve}from"./chunk-V6CNCQF3.js";import{$a as _e,Aa as h,Bb as V,Cb as Be,Ea as b,Fa as de,G as D,Ga as $,H as w,Ha as z,Ia as ue,Ja as he,K as s,La as H,Ma as G,Oa as fe,Pa as me,R as j,Ra as m,Sa as pe,Ta as ge,U as ie,X as O,Xa as Z,Ya as I,ab as q,b as k,ba as N,bb as ve,c as f,da as ne,ea as u,fa as oe,g as X,ga as se,i as v,ia as d,ja as C,ka as E,l as K,o as p,p as ee,pb as we,qa as T,ra as U,sa as W,sb as Q,ta as ae,tb as Ce,u as te,ub as be,vb as Se,wa as le,wb as xe,x as re,xa as ce,xb as ye,ya as a,yb as S,za as l,zb as Re}from"./chunk-CYPUUF2W.js";import{a as R,b as M}from"./chunk-ACKELEN3.js";var Ge=["*",[["mat-toolbar-row"]]],Ze=["*","mat-toolbar-row"],qe=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275dir=E({type:r,selectors:[["mat-toolbar-row"]],hostAttrs:[1,"mat-toolbar-row"],exportAs:["matToolbarRow"]})}return r})(),Pe=(()=>{class r{_elementRef=s(O);_platform=s(F);_document=s(j);color;_toolbarRows;constructor(){}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){this._toolbarRows.length}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=d({type:r,selectors:[["mat-toolbar"]],contentQueries:function(e,i,o){if(e&1&&he(o,qe,5),e&2){let c;H(c=G())&&(i._toolbarRows=c)}},hostAttrs:[1,"mat-toolbar"],hostVars:6,hostBindings:function(e,i){e&2&&(ae(i.color?"mat-"+i.color:""),W("mat-toolbar-multiple-rows",i._toolbarRows.length>0)("mat-toolbar-single-row",i._toolbarRows.length===0))},inputs:{color:"color"},exportAs:["matToolbar"],ngContentSelectors:Ze,decls:2,vars:0,template:function(e,i){e&1&&($(Ge),z(0),z(1,1))},styles:[`.mat-toolbar{background:var(--mat-toolbar-container-background-color, var(--mat-sys-surface));color:var(--mat-toolbar-container-text-color, var(--mat-sys-on-surface))}.mat-toolbar,.mat-toolbar h1,.mat-toolbar h2,.mat-toolbar h3,.mat-toolbar h4,.mat-toolbar h5,.mat-toolbar h6{font-family:var(--mat-toolbar-title-text-font, var(--mat-sys-title-large-font));font-size:var(--mat-toolbar-title-text-size, var(--mat-sys-title-large-size));line-height:var(--mat-toolbar-title-text-line-height, var(--mat-sys-title-large-line-height));font-weight:var(--mat-toolbar-title-text-weight, var(--mat-sys-title-large-weight));letter-spacing:var(--mat-toolbar-title-text-tracking, var(--mat-sys-title-large-tracking));margin:0}@media(forced-colors: active){.mat-toolbar{outline:solid 1px}}.mat-toolbar .mat-form-field-underline,.mat-toolbar .mat-form-field-ripple,.mat-toolbar .mat-focused .mat-form-field-ripple{background-color:currentColor}.mat-toolbar .mat-form-field-label,.mat-toolbar .mat-focused .mat-form-field-label,.mat-toolbar .mat-select-value,.mat-toolbar .mat-select-arrow,.mat-toolbar .mat-form-field.mat-focused .mat-select-arrow{color:inherit}.mat-toolbar .mat-input-element{caret-color:currentColor}.mat-toolbar .mat-mdc-button-base.mat-mdc-button-base.mat-unthemed{--mat-button-text-label-text-color:var(--mat-toolbar-container-text-color, var(--mat-sys-on-surface));--mat-button-outlined-label-text-color:var(--mat-toolbar-container-text-color, var(--mat-sys-on-surface))}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap;height:var(--mat-toolbar-standard-height, 64px)}@media(max-width: 599px){.mat-toolbar-row,.mat-toolbar-single-row{height:var(--mat-toolbar-mobile-height, 56px)}}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%;min-height:var(--mat-toolbar-standard-height, 64px)}@media(max-width: 599px){.mat-toolbar-multiple-rows{min-height:var(--mat-toolbar-mobile-height, 56px)}}
`],encapsulation:2,changeDetection:0})}return r})();var Le=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=C({type:r});static \u0275inj=w({imports:[J,J]})}return r})();var Ae=(()=>{let n=class n{constructor(){this.send=_e(),this.messageControl=new De}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=d({type:n,selectors:[["app-message-input"]],outputs:{send:"send"},decls:4,vars:1,consts:[["type","text","placeholder","type a message...",3,"formControl"],["mat-button","",3,"click"]],template:function(i,o){i&1&&(h(0,"input",0),a(1,"button",1),b("click",function(){return o.send.emit(o.messageControl.value),o.messageControl.reset()}),a(2,"mat-icon"),m(3,"send"),l()()),i&2&&T("formControl",o.messageControl)},dependencies:[Ee,Me,ke,Oe,B,Fe,L,P],styles:["[_nghost-%COMP%]{width:100%;position:relative}input[_ngcontent-%COMP%]{width:100%;background:var(--white);border:none;font-size:1.2em;padding:2rem 1rem}button[_ngcontent-%COMP%]{height:100%!important;position:absolute;right:0;bottom:0}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:0}"]});let r=n;return r})();var A=function(){return A=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},A.apply(this,arguments)};var tt={includeMetadataChanges:!1};function rt(r,n){return n===void 0&&(n=tt),new k(function(t){var e=ye(r,n,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:e}})}function it(r,n){var t;n===void 0&&(n={});var e=r.data(n);return!r.exists()||typeof e!="object"||e===null||!n.idField?e:A(A({},e),(t={},t[n.idField]=r.id,t))}function nt(r){return rt(r,{includeMetadataChanges:!0}).pipe(v(function(n){return n.docs}))}function je(r,n){return n===void 0&&(n={}),nt(r).pipe(v(function(t){return t.map(function(e){return it(e,n)})}))}var Ne=(()=>{let n=class n{constructor(){this.firestore=s(Be),this.authService=s(V),this.authUser$=Re(this.authService.user),this.messages$=this.getMessages().pipe(re({delay:()=>this.authUser$.pipe(p(e=>!!e))})),this.add$=new f,this.error$=new f,this.logout$=this.authUser$.pipe(p(e=>!e)),this.state=ie({messages:[],error:null}),this.messages=Z(()=>this.state().messages),this.error=Z(()=>this.state().error),this.messages$.pipe(S()).subscribe(e=>this.state.update(i=>M(R({},i),{messages:e}))),this.add$.pipe(S(),te(e=>this.addMessage(e))).subscribe({error:e=>{console.log(e),this.error$.next("Failed to send message")}}),this.logout$.pipe(S()).subscribe(()=>this.state.update(e=>M(R({},e),{messages:[]}))),this.error$.pipe(S()).subscribe(e=>this.state.update(i=>M(R({},i),{error:e})))}getMessages(){let e=Ce(Q(this.firestore,"messages"),be("created","desc"),Se(50));return je(e,{idField:"id"}).pipe(v(i=>[...i].reverse()))}addMessage(e){let i={author:this.authService.user()?.email,content:e,created:Date.now().toString()},o=Q(this.firestore,"messages");return K(()=>xe(o,i))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=D({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();var ot=20,st=(()=>{class r{_ngZone=s(N);_platform=s(F);_renderer=s(oe).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new f;_scrolledCount=0;scrollContainers=new Map;register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){let e=this.scrollContainers.get(t);e&&(e.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=ot){return this._platform.isBrowser?new k(e=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let i=t>0?this._scrolled.pipe(ee(t)).subscribe(e):this._scrolled.subscribe(e);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):X()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((t,e)=>this.deregister(e)),this._scrolled.complete()}ancestorScrolled(t,e){let i=this.getAncestorScrollContainers(t);return this.scrolled(e).pipe(p(o=>!o||i.indexOf(o)>-1))}getAncestorScrollContainers(t){let e=[];return this.scrollContainers.forEach((i,o)=>{this._scrollableContainsElement(o,t)&&e.push(o)}),e}_scrollableContainsElement(t,e){let i=Te(e),o=t.getElementRef().nativeElement;do if(i==o)return!0;while(i=i.parentElement);return!1}static \u0275fac=function(e){return new(e||r)};static \u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),y=(()=>{class r{elementRef=s(O);scrollDispatcher=s(st);ngZone=s(N);dir=s(Ve,{optional:!0});_scrollElement=this.elementRef.nativeElement;_destroyed=new f;_renderer=s(se);_cleanupScroll;_elementScrolled=new f;constructor(){}ngOnInit(){this._cleanupScroll=this.ngZone.runOutsideAngular(()=>this._renderer.listen(this._scrollElement,"scroll",t=>this._elementScrolled.next(t))),this.scrollDispatcher.register(this)}ngOnDestroy(){this._cleanupScroll?.(),this._elementScrolled.complete(),this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(t){let e=this.elementRef.nativeElement,i=this.dir&&this.dir.value=="rtl";t.left==null&&(t.left=i?t.end:t.start),t.right==null&&(t.right=i?t.start:t.end),t.bottom!=null&&(t.top=e.scrollHeight-e.clientHeight-t.bottom),i&&_()!=g.NORMAL?(t.left!=null&&(t.right=e.scrollWidth-e.clientWidth-t.left),_()==g.INVERTED?t.left=t.right:_()==g.NEGATED&&(t.left=t.right?-t.right:t.right)):t.right!=null&&(t.left=e.scrollWidth-e.clientWidth-t.right),this._applyScrollToOptions(t)}_applyScrollToOptions(t){let e=this.elementRef.nativeElement;ze()?e.scrollTo(t):(t.top!=null&&(e.scrollTop=t.top),t.left!=null&&(e.scrollLeft=t.left))}measureScrollOffset(t){let e="left",i="right",o=this.elementRef.nativeElement;if(t=="top")return o.scrollTop;if(t=="bottom")return o.scrollHeight-o.clientHeight-o.scrollTop;let c=this.dir&&this.dir.value=="rtl";return t=="start"?t=c?i:e:t=="end"&&(t=c?e:i),c&&_()==g.INVERTED?t==e?o.scrollWidth-o.clientWidth-o.scrollLeft:o.scrollLeft:c&&_()==g.NEGATED?t==e?o.scrollLeft+o.scrollWidth-o.clientWidth:-o.scrollLeft:t==e?o.scrollLeft:o.scrollWidth-o.clientWidth-o.scrollLeft}static \u0275fac=function(e){return new(e||r)};static \u0275dir=E({type:r,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]]})}return r})();var Ue=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=C({type:r});static \u0275inj=w({})}return r})(),We=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=C({type:r});static \u0275inj=w({imports:[Y,Ue,Y,Ue]})}return r})();var lt=(r,n)=>n.created;function ct(r,n){if(r&1&&(a(0,"li")(1,"div",2),h(2,"img",3),l(),a(3,"div",4)(4,"small"),m(5),l(),a(6,"p"),m(7),l()()()),r&2){let t,e=n.$implicit,i=de();U("flex-direction",e.author===((t=i.activeUser())==null?null:t.email)?"row-reverse":"row"),u(2),ue("src","https://api.dicebear.com/7.x/bottts/svg?seed=",e.author.split("@")[0],"",ne),u(3),pe(e.author),u(2),ge(" ",e.content," ")}}var $e=(()=>{let n=class n{constructor(){this.messages=q.required(),this.activeUser=q.required(),this.scrollContainer=ve.required(y),I(()=>{this.messages().length&&this.scrollContainer()&&this.scrollContainer().scrollTo({bottom:0,behavior:"smooth"})})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=d({type:n,selectors:[["app-message-list"]],viewQuery:function(i,o){i&1&&fe(o.scrollContainer,y,5),i&2&&me()},inputs:{messages:[1,"messages"],activeUser:[1,"activeUser"]},decls:3,vars:0,consts:[["cdkScrollable","",1,"gradient-bg"],[3,"flex-direction"],[1,"avatar","animate-in-primary"],[3,"src"],[1,"message","animate-in-secondary"]],template:function(i,o){i&1&&(a(0,"ul",0),le(1,ct,8,6,"li",1,lt),l()),i&2&&(u(),ce(o.messages()))},dependencies:[We,y],styles:["ul[_ngcontent-%COMP%]{height:100%;overflow:scroll;list-style-type:none;padding:1rem 1rem 5rem;margin:0}li[_ngcontent-%COMP%]{display:flex;margin-bottom:2rem}.avatar[_ngcontent-%COMP%]{width:75px;margin:0 1rem;height:auto;filter:drop-shadow(2px 3px 5px var(--accent-darker-color))}.message[_ngcontent-%COMP%]{width:100%;background:var(--white);padding:2rem;border-radius:5px;filter:drop-shadow(2px 4px 3px var(--primary-darker-color))}"]});let r=n;return r})();var Zr=(()=>{let n=class n{constructor(){this.messageService=s(Ne),this.authService=s(V),this.router=s(we),I(()=>{this.authService.user()||this.router.navigate(["auth","login"])})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=d({type:n,selectors:[["app-home"]],decls:8,vars:2,consts:[[1,"container"],["color","primary"],[1,"spacer"],["mat-icon-button","",3,"click"],[3,"messages","activeUser"],[3,"send"]],template:function(i,o){i&1&&(a(0,"div",0)(1,"mat-toolbar",1),h(2,"span",2),a(3,"button",3),b("click",function(){return o.authService.logout()}),a(4,"mat-icon"),m(5,"logout"),l()()(),h(6,"app-message-list",4),a(7,"app-message-input",5),b("send",function(He){return o.messageService.add$.next(He)}),l()()),i&2&&(u(6),T("messages",o.messageService.messages())("activeUser",o.authService.user()))},dependencies:[Ae,$e,Le,Pe,L,P,B,Ie],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}mat-toolbar[_ngcontent-%COMP%]{box-shadow:0 -7px 11px 0 var(--accent-color)}app-message-list[_ngcontent-%COMP%]{height:100%;width:100%}app-message-input[_ngcontent-%COMP%]{position:fixed;bottom:0}"]});let r=n;return r})();export{Zr as default};
